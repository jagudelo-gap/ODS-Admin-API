meta {
  name: Applications by ID
  type: http
  seq: 12
}

get {
  url: {{API_URL}}/v2/applications/{{CreatedApplicationId}}
  body: none
  auth: inherit
}

script:post-response {
  test("GET ApplicationID: Status code is OK", function () {
      expect(res.getStatus()).to.equal(200);
  });
  
  const response = res.getBody();
  const result = res.getBody();
  
  test("GET ApplicationID: Response result matches application", function () {
      const applicationId = bru.getVar("CreatedApplicationId");
      expect(result.id).to.equal(applicationId);
      expect(result.applicationName).to.equal("Test Application");
      expect(result.claimSetName).to.equal("Ed-Fi Sandbox");
      expect(result.educationOrganizationIds.length).to.equal(1);
      expect(result.profileIds.length).to.equal(0);
      expect(result.odsInstanceIds.length).to.equal(1);
  });
  
  test("GET ApplicationID: Response result does not include key or secret", function () {  
      expect(result).to.not.have.property("key");
      expect(result).to.not.have.property("secret");
  });  

  const Ajv = require('ajv');
  const ajv = new Ajv();
  const GetApplicationId = {
    "type": "object",
    "properties": {
      "id": {
        "type": "integer"
      },
      "applicationName": {
        "type": "string"
      },
      "claimSetName": {
        "type": "string"
      },
      "educationOrganizationIds": {
        "type": "array",
        "items": {}
      },
      "vendorId": {
        "type": "integer"
      },
      "profileIds": {
        "type": "array",
        "items": {}
      },
      "odsInstanceIds": {
        "type": "array",
        "items": {}
      }
    },
    "required": [
      "id",
      "applicationName",
      "claimSetName",
      "educationOrganizationIds",
      "vendorId",
      "profileIds",
      "odsInstanceIds"
    ]
  }

  test("GET ApplicationId: Validation Schema Response", () => {
      const valid = ajv.validate(GetApplicationId, response);
      expect(valid).to.be.true;
      
      if (!valid) {
          console.log("Schema validation errors:", ajv.errors);
      }
  });

}

settings {
  encodeUrl: true
}
