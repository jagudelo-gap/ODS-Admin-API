meta {
  name: Vendors
  type: http
  seq: 2
}

post {
  url: {{API_URL}}/v2/vendors
  body: json
  auth: inherit
}

body:json {
  {
      "company": "Test Company",
      "namespacePrefixes": "uri://ed-fi.org",
      "contactName": "Test User",
      "contactEmailAddress": "test@test-ed-fi.org"
  }
}

script:post-response {
  test("POST Vendors: Status code is Created", function () {
      expect(res.getStatus()).to.equal(201);
  });
  
  test("POST Vendors: Response includes location in header", function () {
      expect(res.getHeaders()).to.have.property("location");
      const id = res.getHeader("location").split("/")[2];
      if(id)
      {
          bru.setVar("CreatedVendorId", id);
      }
  });
  
}

settings {
  encodeUrl: true
}

example {
  name: Vendor with multiple namespaces
  
  request: {
    url: {{API_URL}}/vendors
    method: POST
    mode: json
    body:json: {
      {
          "company": {{CompanyName}},
          "namespacePrefixes": "uri://ed-fi.org,uri://academicbenchmarks.com",
          "contactName": {{ContactName}},
          "contactEmailAddress": {{ContactEmail}}
      }
    }
  }
  
  response: {
    headers: {
      Content-Type: application/json; charset=utf-8
      Date: Thu, 02 Jun 2022 23:13:53 GMT
      Server: Kestrel
      Location: /Vendors/2
      Transfer-Encoding: chunked
    }
  
    status: {
      code: Created
      text: 201
    }
  
    body: {
      type: json
      content: '''
        {
            "result": {
                "vendorId": 2,
                "company": "Test Company",
                "namespacePrefixes": "uri://ed-fi.org,uri://academicbenchmarks.com",
                "contactName": "Test User",
                "contactEmailAddress": "test@test-ed-fi.org"
            },
            "status": 201,
            "title": "Vendor created successfully"
        }
      '''
    }
  }
}
