meta {
  name: Tenants by Tenant Name - Singletenant
  type: http
  seq: 5
}

get {
  url: {{API_URL}}/v2/tenants/default
  body: none
  auth: inherit
}

script:post-response {
  if (bru.getVar("isMultitenant") == "false") {
      test("GET Tenants by Tenant Id: Status code is Found", function () {
          expect(res.getStatus()).to.equal(200);
      });
  
      const response = res.getBody();
      const result = res.getBody();
  
      test("GET Tenant Name: Response result matches tenant", function () {
          expect(result.tenantName).to.equal("default");
          expect(result.adminConnectionString.host).to.not.equal(null);
          expect(result.adminConnectionString.database).to.not.equal(null);
          expect(result.securityConnectionString.host).to.not.equal(null);
          expect(result.securityConnectionString.database).to.not.equal(null);
      });
  
      const Ajv = require('ajv');
      const ajv = new Ajv();
      const GetTenantsByTenantSchema = {
          "type": "object",
          "properties": {
          "tenantName": {
              "type": "string"
          },
          "adminConnectionString": {
              "type": "object",
              "properties": {
              "host": {
                  "type": "string"
              },
              "database": {
                  "type": "string"
              }
              },
          },
          "securityConnectionString": {
              "type": "object",
              "properties": {
              "host": {
                  "type": "string"
              },
              "database": {
                  "type": "string"
              }
              }
          }
          },
          "required": [
          "tenantName"
          ]
      }
  
      test("GET Tenants by Tenant Id: Validation Schema Response", () => {
          const valid = ajv.validate(GetTenantsByTenantSchema, response);
          expect(valid).to.be.true;
          
          if (!valid) {
              console.log("Schema validation errors:", ajv.errors);
          }
      });
  }
}

settings {
  encodeUrl: true
}
